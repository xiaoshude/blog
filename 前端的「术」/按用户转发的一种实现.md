# 按用户转发的一种实现

> 转发和路由的内涵一致

## 背景

转发关注这一段：端上发起请求后到业务 Server 开始处理前。这段过程，涉及一系列的路由规则，转发的主要内容即是这些路由规则。

负载均衡、灰度、蓝绿发布、A/B test、背后的核心都是转发，所以，转发的实现在网络应用中十分重要。

转发的需求，可以分为以下几类：

1. 按路径转发，比如 nginx ；
2. 按权重转发，比如负载均衡服务；
3. 按用户转发，也就是本文讨论的核心，如何做按用户的请求转发。

## 方案

按用户转发有两个关键点：

- 如何从请求中提取用户标识；
- 如何动态下发用户和目的服务的对应关系；

### 从请求中提取用户标识

这里和请求的应用层协议相关：

1. HTTP 等开放协议；
2. RPC 间的私有协议；

这里只讨论 HTTP 协议，及兼容 HTTP 协议的 WS 协议。
