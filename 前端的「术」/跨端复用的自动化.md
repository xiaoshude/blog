# 自动化跨端复用的实践

## 背景

[<<从交付 API 到交付 SDK>>](https://zhuanlan.zhihu.com/p/457473995)里，探讨了 Node 开发 HTTP Server，如何跨端复用。

实际开发中，还有另一种场景：Node 开发 RPC Server。
因为存在接口协议文件（比如 protobuf），可以利用 protoc 直接生成 RPC Server 桩代码，这时一般由通用的 HTTP Server 完成 HTTP 请求到 RPC 请求的转换。如何在封装完 RPC 接口后，自动给端上交付 HTTP 调用 SDK 呢？

## 预备

这里假定了 RPC 和 protobuf 的预备知识，如果之前没接触过，可以先到：

- [An introduction to gRPC and protocol buffers.](https://grpc.io/docs/what-is-grpc/introduction/)
- [What are protocol buffers?](https://developers.google.com/protocol-buffers)

简单了解下。

## 问题引入

RPC 有三个特点：

- 多在微服务场景；
- 多种开发语言共存；
- 直接开发的是 RPC server，而不是 HTTP server；

相对应 Node 直接开发 HTTP Server，有以下困难：

- Node 服务中的测试代码都是针对 RPC 接口，所以无法直接提成 SDK 供端上调用；
- 有些 HTTP 接口，背后可能是用 Go 或其他语言写的 RPC Server，导致类型定义也无法复用；

## 问题分析

「复用」可以理解为完成自动化的一种手段 —— 直接引用已有的代码片段，另一个手段是：代码生成。

接口协议文件（protobuf），明确定义了 RPC 接口的出入参；其次，既然存在通用的 HTTP Server 转 RPC 请求，意味着：HTTP 和 RPC 请求存在映射规则。

1. 结构化的接口协议文件
2. 固定的 HTTP 到 RPC 转换规则

这两点，是能通过 protobuf 自动生成 HTTP 请求 SDK 的前提。

## 解决方案

我们的目标是，给定 protobuf，自动生成：

1. 接口请求函数
2. 接口出入参类型

## 总结
